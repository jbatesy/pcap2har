# pcap2har

Convert PCAP (packet capture) files to HAR (HTTP Archive) format.

## Features

- Parses HTTP/1.x and HTTP/2 traffic from PCAP files
- Supports TLS decryption via key log files
- Generates HAR 1.2 compliant output
- Command-line interface and Python API

## Requirements

- Python 3.8+
- tshark (Wireshark command-line tool)
- PyYAML

## Installation

```bash
pip install pyyaml
```

Ensure `tshark` is installed and available in your PATH:
- **macOS**: `brew install wireshark`
- **Ubuntu/Debian**: `sudo apt install tshark`
- **Windows**: Install Wireshark (includes tshark)

## Usage

### Command Line

```bash
# Basic usage - outputs to stdout
python -m pcap2har capture.pcap

# Save to file
python -m pcap2har capture.pcap -o output.har

# Decrypt HTTPS traffic using TLS key log file
python -m pcap2har encrypted.pcap --keylog keys.txt -o output.har

# Compact output (no indentation)
python -m pcap2har capture.pcap --indent 0

# Exclude response bodies
python -m pcap2har capture.pcap --no-body -o output.har
```

### Python API

```python
from pcap2har import PcapToHarConverter

# Create converter with optional TLS key log file
converter = PcapToHarConverter(keylog_file="keys.txt")

# Convert to file
converter.convert_to_file("capture.pcap", "output.har")

# Or get JSON string
har_json = converter.convert_to_json("capture.pcap")

# Or work with the HarBuilder directly
builder = converter.convert("capture.pcap")
print(f"Found {len(builder.log.entries)} HTTP transactions")
```

### Working with HAR Data

```python
from pcap2har import HarBuilder, HarEntry, HarRequest, HarResponse

# Build HAR manually
builder = HarBuilder(creator_name="my-tool", creator_version="1.0")

# Add entries
entry = HarEntry(
    startedDateTime="2024-01-01T00:00:00.000Z",
    time=100,
    request=HarRequest(
        method="GET",
        url="https://example.com/",
        httpVersion="HTTP/2.0",
        headersSize=-1,
        bodySize=0,
    ),
    response=HarResponse(
        status=200,
        statusText="OK",
        httpVersion="HTTP/2.0",
        headersSize=-1,
        bodySize=1234,
    ),
)
builder.add_entry(entry)

# Export
builder.save("output.har")
```

## TLS Decryption

To decrypt HTTPS traffic, you need a TLS key log file. This can be generated by:

1. **Browsers**: Set the `SSLKEYLOGFILE` environment variable before starting your browser:
   ```bash
   export SSLKEYLOGFILE=/path/to/keylog.txt
   firefox  # or chrome
   ```

2. **curl**: Use `--ssl-keylog-file`:
   ```bash
   curl --ssl-keylog-file /path/to/keylog.txt https://example.com
   ```

3. **Python requests**: Set the environment variable or use custom SSL context

Then pass the key log file to pcap2har:
```bash
python -m pcap2har capture.pcap --keylog keylog.txt -o output.har
```

## HAR 1.2 Specification

This tool generates HAR files conforming to the [HAR 1.2 specification](https://github.com/ahmadnassri/har-spec/blob/master/versions/1.2.md).

## License

MIT
